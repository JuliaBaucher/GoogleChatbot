<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>JULIA BAUCHER – AI CV Assistant</title>

    <style>

        :root {

            --bg-color: #f8f9fa;

            --container-bg: #ffffff;

            --text-main: #212529;

            --text-muted: #6c757d;

            --primary-color: #007bff;

            --primary-hover: #0056b3;

            --user-bubble: #007bff;

            --user-text: #ffffff;

            --ai-bubble: #e9ecef;

            --ai-text: #212529;

            --border-color: #dee2e6;

            --error-bg: #f8d7da;

            --error-text: #721c24;

            --shadow: 0 4px 12px rgba(0,0,0,0.05);

        }



        @media (prefers-color-scheme: dark) {

            :root {

                --bg-color: #121212;

                --container-bg: #1e1e1e;

                --text-main: #e0e0e0;

                --text-muted: #a0a0a0;

                --primary-color: #3791ff;

                --user-bubble: #3791ff;

                --ai-bubble: #2d2d2d;

                --ai-text: #e0e0e0;

                --border-color: #333333;

                --shadow: 0 4px 12px rgba(0,0,0,0.3);

            }

        }



        * { box-sizing: border-box; }

        body {

            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;

            background-color: var(--bg-color);

            color: var(--text-main);

            margin: 0;

            display: flex;

            flex-direction: column;

            height: 100vh;

            line-height: 1.5;

        }



        header {

            padding: 2rem 1rem;

            max-width: 800px;

            margin: 0 auto;

            text-align: center;

        }

        h1 { margin: 0 0 0.5rem 0; font-size: 1.75rem; letter-spacing: -0.02em; }

        .subtitle { color: var(--text-muted); font-size: 0.95rem; max-width: 600px; margin: 0 auto; }



        main {

            flex: 1;

            display: flex;

            flex-direction: column;

            max-width: 800px;

            width: 100%;

            margin: 0 auto;

            background: var(--container-bg);

            border-radius: 12px 12px 0 0;

            box-shadow: var(--shadow);

            overflow: hidden;

            position: relative;

        }



        #chat-window {

            flex: 1;

            overflow-y: auto;

            padding: 1.5rem;

            display: flex;

            flex-direction: column;

            gap: 1rem;

            scroll-behavior: smooth;

        }



        .msg {

            max-width: 85%;

            padding: 0.8rem 1rem;

            border-radius: 18px;

            font-size: 0.95rem;

            position: relative;

            word-wrap: break-word;

            white-space: pre-wrap;

            display: flex;

            flex-direction: column;

        }

        .msg-user {

            align-self: flex-end;

            background-color: var(--user-bubble);

            color: var(--user-text);

            border-bottom-right-radius: 4px;

        }

        .msg-ai {

            align-self: flex-start;

            background-color: var(--ai-bubble);

            color: var(--ai-text);

            border-bottom-left-radius: 4px;

        }

        .msg-error {

            align-self: center;

            background-color: var(--error-bg);

            color: var(--error-text);

            font-size: 0.85rem;

            border-radius: 8px;

            text-align: center;

            padding: 0.5rem 1rem;

        }



        .copy-btn {

            background: none;

            border: none;

            color: var(--text-muted);

            font-size: 0.7rem;

            cursor: pointer;

            padding: 4px 0 0 0;

            text-align: right;

            text-decoration: underline;

            opacity: 0.7;

        }

        .copy-btn:hover { opacity: 1; }



        .typing { display: flex; gap: 4px; padding: 10px; }

        .dot {

            width: 6px; height: 6px;

            background: var(--text-muted);

            border-radius: 50%;

            animation: bounce 1.4s infinite ease-in-out both;

        }

        .dot:nth-child(1) { animation-delay: -0.32s; }

        .dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1.0); } }



        .input-container {

            padding: 1.5rem;

            border-top: 1px solid var(--border-color);

            background: var(--container-bg);

        }

        .input-wrapper { display: flex; flex-direction: column; gap: 0.5rem; }

        textarea {

            width: 100%;

            border: 1px solid var(--border-color);

            border-radius: 8px;

            padding: 0.8rem 1rem;

            font-family: inherit;

            font-size: 1rem;

            resize: none;

            max-height: 200px;

            background: var(--bg-color);

            color: var(--text-main);

            outline: none;

        }

        textarea:focus { border-color: var(--primary-color); }



        .controls { display: flex; justify-content: space-between; align-items: center; }

        .char-counter { font-size: 0.75rem; color: var(--text-muted); }

        .btn-group { display: flex; gap: 0.5rem; }

        button {

            padding: 0.6rem 1.2rem;

            border-radius: 6px;

            border: none;

            cursor: pointer;

            font-weight: 600;

        }

        button:disabled { opacity: 0.5; cursor: not-allowed; }

        .btn-send { background: var(--primary-color); color: white; }

        .btn-clear { background: transparent; color: var(--text-muted); border: 1px solid var(--border-color); }



        footer { padding: 1rem; font-size: 0.75rem; color: var(--text-muted); text-align: center; }

    </style>

</head>

<body>



<header>

    <h1>JULIA BAUCHER – AI CV Assistant</h1>

    <p class="subtitle">I am an AI assistant trained on Julia's profile. Ask me about her work experience, technical projects, or background.</p>

</header>



<main>

    <div id="chat-window"></div>

    <div class="input-container">

        <div class="input-wrapper">

            <textarea id="user-input" placeholder="Ask me something about Julia..." rows="1" maxlength="4000"></textarea>

            <div class="controls">

                <span id="char-count" class="char-counter">0 / 4000</span>

                <div class="btn-group">

                    <button id="clear-btn" class="btn-clear">Clear</button>

                    <button id="send-btn" class="btn-send">Send</button>

                </div>

            </div>

        </div>

    </div>

</main>



<footer>

    <p>Powered by Google Gemini 1.5 & Google Cloud Run</p>

</footer>



<script>

    // URL exacte de votre service Cloud Run

    const API_ENDPOINT = "https://askgemini-758894489459.europe-west1.run.app"; 

    const MAX_CHARS = 4000;



    const chatWindow = document.getElementById('chat-window');

    const userInput = document.getElementById('user-input');

    const sendBtn = document.getElementById('send-btn');

    const clearBtn = document.getElementById('clear-btn');

    const charCount = document.getElementById('char-count');



    let chatHistory = JSON.parse(localStorage.getItem('cv_chat_history')) || [];



    function init() {

        chatHistory.forEach(msg => appendMessage(msg.role, msg.text, false));

        updateCharCount();

        userInput.focus();

    }



    function appendMessage(role, text, save = true) {

        if (!text) return;

        const msgDiv = document.createElement('div');

        msgDiv.className = `msg msg-${role}`;

        

        const textSpan = document.createElement('span');

        textSpan.textContent = text;

        msgDiv.appendChild(textSpan);



        if (role === 'ai') {

            const copyBtn = document.createElement('button');

            copyBtn.className = 'copy-btn';

            copyBtn.textContent = 'Copy';

            copyBtn.onclick = () => {

                navigator.clipboard.writeText(text);

                copyBtn.textContent = 'Copied!';

                setTimeout(() => copyBtn.textContent = 'Copy', 2000);

            };

            msgDiv.appendChild(copyBtn);

        }



        chatWindow.appendChild(msgDiv);

        chatWindow.scrollTop = chatWindow.scrollHeight;



        if (save) {

            chatHistory.push({ role, text });

            localStorage.setItem('cv_chat_history', JSON.stringify(chatHistory));

        }

    }



    function showLoading() {

        const loader = document.createElement('div');

        loader.id = 'ai-loader';

        loader.className = 'msg msg-ai';

        loader.innerHTML = `<div class="typing"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>`;

        chatWindow.appendChild(loader);

        chatWindow.scrollTop = chatWindow.scrollHeight;

    }



    function removeLoading() {

        const loader = document.getElementById('ai-loader');

        if (loader) loader.remove();

    }



    function updateCharCount() {

        const len = userInput.value.length;

        charCount.textContent = `${len} / ${MAX_CHARS}`;

        sendBtn.disabled = len === 0 || !userInput.value.trim();

    }



    async function handleSend() {

        const text = userInput.value.trim();

        if (!text) return;



        appendMessage('user', text);

        userInput.value = '';

        updateCharCount();

        

        showLoading();

        sendBtn.disabled = true;



        try {

            const response = await fetch(API_ENDPOINT, {

                method: 'POST',

                headers: { 'Content-Type': 'application/json' },

                body: JSON.stringify({ message: text })

            });



            const data = await response.json();

            removeLoading();



            // Gestion de la réponse avec fallback si "reply" est absent

            const aiReply = data.reply || data.message || "I received a response but couldn't parse the text.";

            appendMessage('ai', aiReply);



        } catch (err) {

            removeLoading();

            appendMessage('error', "Connection error. Please try again in a few seconds.");

            console.error("Fetch error:", err);

        } finally {

            sendBtn.disabled = false;

            userInput.focus();

        }

    }



    userInput.addEventListener('input', updateCharCount);

    userInput.addEventListener('keydown', (e) => {

        if (e.key === 'Enter' && !e.shiftKey) {

            e.preventDefault();

            handleSend();

        }

    });



    sendBtn.addEventListener('click', handleSend);

    clearBtn.addEventListener('click', () => {

        if (confirm('Clear chat?')) {

            chatHistory = [];

            localStorage.removeItem('cv_chat_history');

            chatWindow.innerHTML = '';

        }

    });



    init();

</script>

</body>

</html>

